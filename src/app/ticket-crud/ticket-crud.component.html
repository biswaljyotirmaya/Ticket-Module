<div class="container py-4">
  <div class="card shadow rounded-3 border-0">
    <div class="card-header bg-primary text-white fw-semibold fs-5">
      Ticket Management
    </div>
    <div class="card-body p-0">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light text-center">
          <tr>
            <th>Title</th>
            <th>Assignee</th>
            <th>Status</th>
            <th>Priority</th>
            <th></th>
            <th>Options</th>
          </tr>
        </thead>
        <tbody>

          <!-- ðŸ”¼ Add Ticket Form -->
          <tr>
            <td><input [(ngModel)]="ticket.titleTicket" class="form-control form-control-sm" placeholder="Title" /></td>
            <td><input [(ngModel)]="ticket.assign" class="form-control form-control-sm" placeholder="Assignee" /></td>
            <td>
              <select [(ngModel)]="ticket.status" class="form-select form-select-sm">
                <option value="">Select</option>
                <option value="Open">To Do</option>
                <option value="In Progress">In Progress</option>
                <option value="Closed">Completed</option>
              </select>
            </td>
            <td>
              <select [(ngModel)]="ticket.priority" class="form-select form-select-sm">
                <option value="">Select</option>
                <option value="Low">Low</option>
                <option value="Medium">Medium</option>
                <option value="High">High</option>
              </select>
            </td>
            <td>-</td>
            <td class="text-center">
              <button class="btn btn-success btn-sm me-1" (click)="createTicket()"
                [disabled]="!ticket.titleTicket || !ticket.status || !ticket.priority">
                <i class="bi bi-check-lg"></i>
              </button>
              <button class="btn btn-secondary btn-sm" (click)="resetForm()">
                <i class="bi bi-x-lg"></i>
              </button>
            </td>
          </tr>

          <!-- â¬‡ Existing Tickets -->
          <tr *ngFor="let t of tickets">
            <td>
              <a href="#" (click)="goToTicketPanel(t.sno); $event.preventDefault()"
                 class="fw-semibold text-decoration-none text-primary">
                {{ t.titleTicket }}
              </a>
            </td>
            <td>{{ t.assign || '-' }}</td>
            <td>{{ t.status || '-' }}</td>
            <td>{{ t.priority || '-' }}</td>
            <td>{{ t.dateCurrent || '-' }}</td>
            <td class="text-center">
              <button class="btn btn-outline-warning btn-sm me-1" (click)="openEditModal(t)" title="Edit">
                <i class="bi bi-pencil"></i>
              </button>
              <button class="btn btn-outline-danger btn-sm" (click)="confirmDelete(t.sno)" title="Delete">
                <i class="bi bi-trash"></i>
              </button>
            </td>
          </tr>

        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- âœ… Edit Ticket Modal -->
<div class="modal fade" id="editTicketModal" tabindex="-1" aria-labelledby="editTicketModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content border-0 rounded-3 shadow">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="editTicketModalLabel">Edit Ticket</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Title</label>
            <input [(ngModel)]="ticket.titleTicket" class="form-control form-control-sm" />
          </div>
          <div class="col-md-6">
            <label class="form-label">Assignee</label>
            <input [(ngModel)]="ticket.assign" class="form-control form-control-sm" />
          </div>
          <div class="col-md-6">
            <label class="form-label">Status</label>
            <select [(ngModel)]="ticket.status" class="form-select form-select-sm">
              <option value="Open">To Do</option>
              <option value="In Progress">In Progress</option>
              <option value="Closed">Completed</option>
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label">Priority</label>
            <select [(ngModel)]="ticket.priority" class="form-select form-select-sm">
              <option value="Low">Low</option>
              <option value="Medium">Medium</option>
              <option value="High">High</option>
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label">Date</label>
            <input type="date" [(ngModel)]="ticket.dateCurrent" class="form-control form-control-sm" />
          </div>
          <div class="col-md-12">
            <label class="form-label">Sub Task</label>
            <textarea [(ngModel)]="ticket.subTask" rows="2" class="form-control form-control-sm"></textarea>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-primary btn-sm" (click)="updateTicket()" data-bs-dismiss="modal">Update</button>
      </div>
    </div>
  </div>
</div>

<!-- âœ… Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 rounded-3 shadow">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="deleteConfirmModalLabel">Confirm Deletion</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center">
        <i class="bi bi-exclamation-triangle fs-2 text-warning"></i>
        <p class="mt-3 mb-0">Are you sure you want to delete this ticket?</p>
      </div>
      <div class="modal-footer justify-content-center">
        <button class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-danger btn-sm" (click)="deleteTicket()" data-bs-dismiss="modal">Delete</button>
      </div>
    </div>
  </div>
</div>
